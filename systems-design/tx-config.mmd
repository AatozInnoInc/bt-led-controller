%%{init: {
  "theme": "dark",
  "themeVariables": {
    "primaryColor": "#0d1117",
    "primaryTextColor": "#e6edf3",
    "primaryBorderColor": "#30363d",
    "lineColor": "#58a6ff",
    "secondaryColor": "#161b22",
    "actorBorder": "#58a6ff",
    "actorBkg": "#1f6feb",
    "actorTextColor": "#ffffff",
    "signalColor": "#58a6ff",
    "loopTextColor": "#e6edf3",
    "altBackground": "#161b22",
    "altTextColor": "#e6edf3",
    "sequenceNumberColor": "#7ee787"
  }
}}%%


sequenceDiagram
    autonumber
    participant User as ðŸŽ¸ User
    participant App as React Native App
    participant BLE as BLE Service (GATT)
    participant MCU as Microcontroller
    participant RAM as RAM Buffer
    participant FLASH as Flash Memory

    User->>App: Opens Configuration UI
    App->>BLE: Establish BLE Connection
    BLE->>MCU: Connect Event
    MCU-->>App: Acknowledge + Current Config Snapshot

    loop Real-time Adjustments
        User->>App: Adjust parameter (e.g., LED color/brightness)
        App->>BLE: Send ConfigUpdate(payload)
        BLE->>MCU: Forward payload
        MCU->>MCU: Validate Input (range/type/idempotent)
        alt Valid
            MCU->>RAM: Apply Temporarily
            RAM->>MCU: Real-time LED/Effector Update
            MCU-->>BLE: Ack + Notify Success
        else Invalid
            MCU-->>BLE: ErrorEnvelope {code, message}
        end
        BLE-->>App: Response (Notify/WriteAck)
        App-->>User: Visual Feedback (applied or rejected)
    end

    User->>App: Press â€œSave Configurationâ€
    App->>BLE: CommitConfig()
    BLE->>MCU: Commit Request
    MCU->>FLASH: Write New Config (if different)
    FLASH-->>MCU: Success
    MCU-->>BLE: Commit Ack
    BLE-->>App: â€œConfiguration Savedâ€

    App->>BLE: Disconnect
    BLE->>MCU: Disconnect Event
    MCU->>MCU: Revert to Run Mode
