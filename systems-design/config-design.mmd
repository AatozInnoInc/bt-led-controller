%%{init: {
  "theme": "dark",
  "themeVariables": {
    "primaryColor": "#0d1117",
    "primaryTextColor": "#e6edf3",
    "primaryBorderColor": "#30363d",
    "lineColor": "#58a6ff",
    "secondaryColor": "#161b22",
    "actorBorder": "#58a6ff",
    "actorBkg": "#1f6feb",
    "actorTextColor": "#ffffff",
    "signalColor": "#58a6ff",
    "loopTextColor": "#e6edf3",
    "altBackground": "#161b22",
    "altTextColor": "#e6edf3",
    "sequenceNumberColor": "#7ee787"
  }
}}%%

sequenceDiagram
    participant UI as ConfigScreen
    participant CFG as ConfigDomainController
    participant BLE as BluetoothService
    participant REP as ConfigRepository
    participant MCU as Microcontroller

    UI->>CFG: Enter Config Mode
    CFG->>BLE: Send CMD_ENTER_CONFIG
    BLE->>MCU: [0x10] Enter Config Mode
    MCU-->>BLE: Ack [0x90]
    BLE-->>CFG: Mode Active
    CFG->>REP: Load Cached Config
    REP-->>CFG: Return Data
    CFG->>UI: Populate Sliders, Colors

    loop User Adjusts Settings
        UI->>CFG: New Setting
        CFG->>BLE: Send ConfigCommand
        BLE->>MCU: [0x02, 0x7F]
        MCU-->>BLE: Ack
        BLE-->>CFG: Confirm
        CFG->>UI: Update Visuals
    end

    UI->>CFG: Save Config
    CFG->>REP: Serialize + Validate
    CFG->>BLE: Send CMD_COMMIT_CONFIG
    MCU-->>BLE: Commit Ack
    CFG->>UI: Success
